#!/bin/execlineb -P

if { s6-hiercopy /etc/s6/service /run/service }
if { s6-mkfifo -m0600 /run/service/s6-svscan-log/fifo }
if { /sbin/restorecon -RF /run }

s6-envdir -I -- /etc/s6/env
redirfd -r 0 /dev/null
redirfd -wnb 1 /run/service/s6-svscan-log/fifo

background
{
    s6-setsid --
    redirfd -w 1 /run/service/s6-svscan-log/fifo
    # output to /dev/console
    fdmove -c 1 2
    /etc/s6/rc.init
}
unexport !

cd /run/service
fdmove -c 2 1
s6-svscan -st0

s6-envdir /etc/s6/env/host/net/eth
importas -iu prefix_via prefix_via

s6-sleep 30

backtick -in prefix
{
    pipeline { ip -6 route }
    pipeline { grep "^[23][0-9a-f:]* via ${prefix_via}" }
    cut -d: -f1-4
}

backtick -in random
{
    pipeline { od -N8 -Anone -tx2 /dev/urandom }
    tr " " ":"
}

multisubstitute
{
    importas -iu dev dev
    importas -iu prefix prefix
    importas -iu random random
}

ip addr add ${prefix}${random}/128 dev ${dev}
